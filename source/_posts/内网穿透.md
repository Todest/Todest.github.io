---
title: 内网穿透
date: 2020-04-08 16:08:24
categories:
  - 计算机网络
tags: 端口映射
abbrlink: bd50b816
---
# 名词解释
&emsp;&emsp;**端口映射**就是将外网主机的IP地址的一个端口映射到内网中一台机器，提供相应的服务。当用户访问该IP的这个端口时，服务器自动将请求映射到对应局域网内部的机器上。端口映射有动态和静态之分。
&emsp;&emsp;通俗来讲，端口映射是将一台主机的内网(LAN)IP地址映射成一个公网(WAN)IP地址，当用户访问提供映射端口主机的某个端口时，服务器将请求转移到本地局域网内部提供这种特定服务的主机；利用端口映射功能还可以将一台外网IP地址机器的多个端口映射到内网不同机器上的不同端口。 端口映射功能还可以完成一些特定代理功能，比如代理POP，SMTP，TELNET等协议。理论上可以提供65535(总端口数)-1024(保留端口数)=64511个端口的映射。

&emsp;&emsp;**内网穿透**，即NAT穿透，网络连接时术语，计算机是局域网内时，外网与内网的计算机节点需要连接通信，有时就会出现不支持内网穿透。就是说映射端口，能让外网的电脑找到处于内网的电脑，提高下载速度。不管是内网穿透还是其他类型的网络穿透，都是网络穿透的统一方法来研究和解决。

<!--more-->
# 方式
## FRP
&emsp;&emsp;假如你有一个有公网IP的服务器，并且网速不是太差的话，frp就是一个不错的选择，当然如果没有的话，可以用后面的方法。

### 下载frp
> frp项目地址：https://github.com/fatedier/frp

进入realses界面下载需要的版本，下载完成后分别解压到服务器和客户端上。
这里以linux（服务器），windows(客户端)为例。

### linux服务器上配置
下载并解压文件。
```bash
wget https://github.com/fatedier/frp/releases/download/v0.29.0/frp_0.29.0_linux_amd64.tar.gz
tar xzvf frp_0.29.0_linux_amd64.tar.gz
# 可以给文件夹改个短点的名字
mv frp_0.29.0_linux_amd64 frp
```
配置服务端frp配置文件。
```bash
cd frp
vim frps.ini
```
按 $I$ 键进入插入模式，输入以下内容。
```ini
[common]
bind_port = 7000  # 默认监听端口，为服务器和客户端通信的端口，可以根据实际情况进行更改。
token = 12345678  # 认证秘钥，客户端需与服务端一致才可以连接，可以不写这一行。
```
按 $Esc$ 退出插入模式，并输入”:wq”保存（w）并退出（q），不包括引号。
至此，服务端已配置完毕，接下来运行即可。
```bash
./frps -c frps.ini # 运行时需保持终端打开，否则会结束运行。Ctrl+C手动结束运行。
nohup ./frps -c frps.ini # 放到后台运行，服务器重启需重新执行。
```
以上方式运行未免还是有些不方便，所以最好将其写入到systemd服务。
```bash
sudo vim /etc/systemd/system/frps.service
```
写入以下内容。
```nohilight
[Unit]
Description=frps daemon    # 服务名称，随便填写即可
After=syslog.target  network.target
Wants=network.target

[Service]
Type=simple
ExecStart=/root/frp/frps -c /root/frp/frps.ini   # 修改为你的frps的绝对路径
Restart= always
RestartSec=1min

[Install]
WantedBy=multi-user.target
```
启动服务，并设置开及自动运行。
```bash
sudo systemctl daemon-reload        # 重新加载服务
sudo systemctl enable frps.service  # 开机自启
sudo systemctl start frps           # 启动服务
```
### windows客户端上配置
配置客户端frp配置文件，编辑 frpc.ini。
```ini
[common]
server_addr = 0.0.0.0  # 服务器IP地址或域名
server_port = 7000     # 服务器监听端口
token = 12345678

[mc]   # 此处名称随意
type = tcp  # 协议类型，如udp，http，https，stpx，xtcp
local_port = 25565       # 本地监听端口
remote_port = 25565      # 服务器转发端口
custom_domains = domain  # 服务器域名
```
至此，客户端也配置完毕了，进入到frp文件夹，在此处打开cmd，或powershell。
```bash
.\frpc -c frpc.ini
```
运行以上内容即可，窗口关闭即结束，也可以写入到 run.bat 双击执行。
接下来就可以愉快的玩耍了。

**注：详细配置文件参照frps_full.ini和frpc_full.ini**

## 其他方式
### 花生壳

> 官网：https://hsk.oray.com

一次性付费开通服务，1Mbps带宽，每月1G流量。

### 蒲公英

> 官网：https://pgy.oray.com

免费，仅限三人互相访问，1Mbps带宽。

**还有其他免费平台自行百度即可，此处就不多赘述。**